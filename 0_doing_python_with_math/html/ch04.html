<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Doing Math with Python</title>
<link rel="stylesheet" type="text/css" href="9781593276409.css"/>
</head>
<body>
<h2 class="h2" id="ch04"><a id="page_93"/><strong><span class="big">4</span></strong><br/><strong>Algebra and Symbolic Math with SymPy</strong></h2>
<div class="image1"><img src="graphics/common-01.jpg" alt="image"/></div>
<p class="noindent">The mathematical problems and solutions in our programs so far have all involved the manipulation of numbers. But there&#8217;s another way math is taught, learned, and practiced, and that&#8217;s in terms of symbols and the operations between them. Just think of all the <em>x</em>s and <em>y</em>s in a typical algebra problem. We refer to this type of math as <em>symbolic math</em>. I&#8217;m sure you remember those dreaded &#8220;factorize <em>x</em><sup>3</sup> + 3<em>x</em><sup>2</sup> + 3<em>x</em> + 1&#8221; problems in your math class. Fear no more, for in this chapter, we learn how to write programs that can solve such problems and much more. To do so, we&#8217;ll use <em>SymPy</em>&#8212;a Python library that lets you write expressions containing symbols and perform operations on them. Because this is a third-party library, you&#8217;ll need to install it before you can use it in your programs. The installation instructions are described in <a href="app01.html#app01">Appendix A</a>.</p>
<h3 class="h3" id="ch04lev1sec01"><a id="page_94"/><strong>Defining Symbols and Symbolic Operations</strong></h3>
<p class="noindent"><em>Symbols</em> form the building blocks of symbolic math. The term <em>symbol</em> is just a general name for the <em>x</em>s, <em>y</em>s, <em>a</em>s, and <em>b</em>s you use in equations and algebraic expressions. Creating and using symbols will let us do things differently than before. Consider the following statements:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;1</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;+&#160;x&#160;+&#160;1</span><br/>3</p>
<p class="indent">Here we create a label, <span class="literal">x</span>, to refer to the number 1. Then, when we write the statement <span class="literal">x + x + 1</span>, it&#8217;s evaluated for us, and the result is 3. What if you wanted the result in terms of the symbol <em>x</em>? That is, if instead of 3, you wanted Python to tell you that the result is 2<em>x</em> + 1? You couldn&#8217;t just write <span class="literal">x + x + 1</span> <em>without</em> the statement <span class="literal">x = 1</span> because Python wouldn&#8217;t know what <span class="literal">x</span> refers to.</p>
<p class="indent">SymPy lets us write programs where we can express and evaluate mathematical expressions in terms of such symbols. To use a symbol in your program, you have to create an object of the <span class="literal">Symbol</span> class, like this:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span></p>
<p class="indent">First, we import the <span class="literal">Symbol</span> class from the <span class="literal">sympy</span> library. Then, we create an object of this class passing <span class="literal">'x'</span> as a parameter. Note that this <span class="literal">'x'</span> is written as a string within quotes. We can now define expressions and equations in terms of this symbol. For example, here&#8217;s the earlier expression:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;+&#160;x&#160;+&#160;1</span><br/>2*x&#160;+&#160;1</p>
<p class="indent">Now the result is given in terms of the symbol <em>x</em>. In the statement <span class="literal">x = Symbol('x')</span>, the <span class="literal">x</span> on the left side is the Python label. This is the same kind of label we&#8217;ve used before, except this time it refers to the symbol <em>x</em> instead of a number&#8212;more specifically, a <span class="literal">Symbol</span> object representing the symbol <span class="literal">'x'</span>. This label doesn&#8217;t necessarily have to match the symbol either&#8212; we could have used a label like <span class="literal">a</span> or <span class="literal">var1</span> instead. So, it&#8217;s perfectly fine to write the preceding statements as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">a&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">a&#160;+&#160;a&#160;+&#160;1</span><br/>2*x&#160;+&#160;1</p>
<p class="indent">Using a non-matching label can be confusing, however, so I would recommend choosing a label that&#8217;s the same letter as the symbol it refers to.</p>
<div class="sidebar">
<p class="sidebart"><a id="page_95"/><strong>FINDING THE SYMBOL REPRESENTED BY A SYMBOL OBJECT</strong></p>
<p class="noindent">For any <span class="literal">Symbol</span> object, its <span class="literal">name</span> attribute is a string that is the actual symbol it represents:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x.name</span><br/>'x'<br/>&gt;&gt;&gt;&#160;<span class="codestrong">a&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">a.name</span><br/>'x'</p>
<p class="indent">You can use <span class="literal">.name</span> on a label to retrieve the symbol that it is storing.</p>
</div>
<p class="indent">Just to be clear, the symbol you create has to be specified as a string. For example, you can&#8217;t create the symbol <em>x</em> using <span class="literal">x = Symbol(x)</span>&#8212;you must define it as <span class="literal">x = Symbol('x')</span>.</p>
<p class="indent">To define multiple symbols, you can either create separate <span class="literal">Symbol</span> objects or use the <span class="literal">symbols()</span> function to define them more concisely. Let&#8217;s say you wanted to use three symbols&#8212;<em>x</em>, <em>y</em>, and <em>z</em>&#8212;in your program. You could define them individually, as we did earlier:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">y&#160;=&#160;Symbol('y')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">z&#160;=&#160;Symbol('z')</span></p>
<p class="indent">But a shorter method would be to use the <span class="literal">symbols()</span> function to define all three at once:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;symbols</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x,y,z&#160;=&#160;symbols('x,y,z')</span></p>
<p class="indent">First, we import the <span class="literal">symbols()</span> function from SymPy. Then, we call it with the three symbols we want to create, written as a string with commas separating them. After this statement is executed, <span class="literal">x</span>, <span class="literal">y</span>, and <span class="literal">z</span> will refer to the three symbols <span class="literal">'x'</span>, <span class="literal">'y'</span>, and <span class="literal">'z'</span>.</p>
<p class="indent">Once you&#8217;ve defined symbols, you can carry out basic mathematical operations on them, using the same operators you learned in <a href="ch01.html#ch01">Chapter 1</a> (<span class="literal">+</span>, <span class="literal">-</span>, <span class="literal">/</span>, <span class="literal">*</span>, and <span class="literal">**</span>). For example, you might do the following:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">y&#160;=&#160;Symbol('y')</span><br/><a id="page_96"/><br/>&gt;&gt;&gt;&#160;<span class="codestrong">s&#160;=&#160;x*y&#160;+&#160;x*y</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">s</span><br/>2*x*y</p>
<p class="indent">Let&#8217;s see whether we can find the product of <span class="literal">x(x + x)</span>:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">p&#160;=&#160;x*(x&#160;+&#160;x)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">p</span><br/>2*x**2</p>
<p class="indent">SymPy will automatically make these simple addition and multiplication calculations, but if we enter a more complex expression, it will remain unchanged. Let&#8217;s see what happens when we enter the expression <span class="literal">(x + 2)*(x + 3)</span>:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">p&#160;=&#160;(x&#160;+&#160;2)*(x&#160;+&#160;3)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">p</span><br/>(x&#160;+&#160;2)*(x&#160;+&#160;3)</p>
<p class="indent">You may have expected SymPy to multiply everything out and output <span class="literal">x**2 + 5*x + 6</span>. Instead, the expression was printed exactly how we entered it. SymPy automatically simplifies only the most basic of expressions and leaves it to the programmer to explicitly require simplification in cases such as the preceding one. If you want to multiply out the expression to get the expanded version, you&#8217;ll have to use the <span class="literal">expand()</span> function, which we&#8217;ll see in a moment.</p>
<h3 class="h3" id="ch04lev1sec02"><strong>Working with Expressions</strong></h3>
<p class="noindent">Now that we know how to define our own symbolic expressions, let&#8217;s learn more about using them in our programs.</p>
<h4 class="h4" id="ch04lev2sec01"><strong><em>Factorizing and Expanding Expressions</em></strong></h4>
<p class="noindent">The <span class="literal">factor()</span> function decomposes an expression into its factors, and the <span class="literal">expand()</span> function expands an expression, expressing it as a sum of individual terms. Let&#8217;s test out these functions with the basic algebraic identity <em>x</em><sup>2</sup> &#8211; <em>y</em><sup>2</sup> = (<em>x</em> + <em>y</em>)(<em>x</em> &#8211; <em>y</em>). The left side of the identity is the expanded version, and the right side depicts the corresponding factorization. Because we have two symbols in the identity, we&#8217;ll create two <span class="literal">Symbol</span> objects:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">y&#160;=&#160;Symbol('y')</span></p>
<p class="indent"><a id="page_97"/>Next, we import the <span class="literal">factor()</span> function and use it to convert the expanded version (on the left side of the identity) to the factored version (on the right side):</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;factor</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x**2&#160;-&#160;y**2</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">factor(expr)</span><br/>(x&#160;-&#160;y)*(x&#160;+&#160;y)</p>
<p class="indent">As expected, we get the factored version of the expression. Now let&#8217;s expand the factors to get back the original expanded version:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from sympy import expand</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">factors&#160;=&#160;factor(expr)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expand(factors)</span><br/>x**2&#160;-&#160;y**2</p>
<p class="indent">We store the factorized expression in a new label, <span class="literal">factors</span>, and then call the <span class="literal">expand()</span> function with it. When we do this, we receive the original expression we started with. Let&#8217;s try it with the more complicated identity <em>x</em><sup>3</sup> + 3<em>x</em><sup>2</sup><em>y</em> + 3<em>xy</em><sup>2</sup> + <em>y</em><sup>3</sup> = (<em>x</em> + <em>y</em>)<sup>3</sup>:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x**3&#160;+&#160;3*x**2*y&#160;+&#160;3*x*y**2&#160;+&#160;y**3</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">factors&#160;=&#160;factor(expr)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">factors</span><br/>(x&#160;+&#160;y)**3<br/><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expand(factors)</span><br/>x**3&#160;+&#160;3*x**2*y&#160;+&#160;3*x*y**2&#160;+&#160;y**3</p>
<p class="indent">The <span class="literal">factor()</span> function is able to factorize the expression, and then the <span class="literal">expand()</span> function expands the factorized expression to return to the original expression.</p>
<p class="indent">If you try to factorize an expression for which there&#8217;s no possible factorization, the original expression is returned by the <span class="literal">factor()</span> function. For example, see the following:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x&#160;+&#160;y&#160;+&#160;x*y</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">factor(expr)</span><br/>x*y&#160;+&#160;x&#160;+&#160;y</p>
<p class="indent">Similarly, if you pass in an expression to <span class="literal">expand()</span> that can&#8217;t be expanded further, it returns the same expression.</p>
<h4 class="h4" id="ch04lev2sec02"><strong><em>Pretty Printing</em></strong></h4>
<p class="noindent">If you want the expressions we&#8217;ve been working with to look a bit nicer when you print them, you can use the <span class="literal">pprint()</span> function. This function will print the expression in a way that more closely resembles how we&#8217;d normally write it on paper. For example, here&#8217;s an expression:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x*x&#160;+&#160;2*x*y&#160;+&#160;y*y</span></p>
<p class="indent"><a id="page_98"/>If we print it as we&#8217;ve been doing so far or use the <span class="literal">print()</span> function, this is how it looks:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr</span><br/>x**2&#160;+&#160;2*x*y&#160;+&#160;y**2</p>
<p class="indent">Now, let&#8217;s use the <span class="literal">pprint()</span> function to print the preceding expression:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;pprint</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">pprint(expr)</span><br/>x<sup>2</sup>&#160;+&#160;2&#183;x&#183;y&#160;+&#160;y<sup>2</sup></p>
<p class="indent">The expression now looks much cleaner&#8212;for example, instead of having a bunch of ugly asterisks, exponents appear above the rest of the numbers.</p>
<p class="indent">You can also change the order of the terms when you print an expression. Consider the expression 1 + 2<em>x</em> + 2<em>x</em><sup>2</sup>:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;1&#160;+&#160;2*x&#160;+&#160;2*x**2</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">pprint(expr)</span><br/>2&#183;x<sup>2</sup>&#160;+&#160;2&#183;x&#160;+&#160;1</p>
<p class="indent">The terms are arranged in the order of powers of <em>x</em>, from highest to lowest. If you want the expression in the opposite order, with the highest power of <em>x</em> last, you can make that happen with the <span class="literal">init_printing()</span> function, as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;init_printing</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">init_printing(order='rev-lex')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">pprint(expr)</span><br/>1&#160;+&#160;2&#183;x&#160;+&#160;2&#183;x<sup>2</sup></p>
<p class="indent">The <span class="literal">init_printing()</span> function is first imported and called with the keyword argument <span class="literal">order='rev-lex'</span>. This indicates that we want SymPy to print the expressions so that they&#8217;re in <em>reverse lexicographical order</em>. In this case, the keyword argument tells Python to print the lower-power terms first.</p>
<div class="note">
<p class="notet"><strong><span class="bordera">NOTE</span></strong></p>
<p class="noindent"><em>Although we used the</em> <span class="literal"><span class="codeitalic">init_printing()</span></span> <em>function here to set the printed order of the expressions, this function can be used in many other ways to configure how an expression is printed. For more options and to learn more about printing in SymPy, see the documentation at</em> <a href="http://docs.sympy.org/latest/tutorial/printing.html">http://docs.sympy.org/latest/tutorial/printing.html</a>.</p>
</div>
<p class="indent">Let&#8217;s apply what we&#8217;ve learned so far to implement a series printing program.</p>
<h5 class="h5" id="ch04lev3sec01"><a id="page_99"/><strong>Printing a Series</strong></h5>
<p class="noindent">Consider the following series:</p>
<div class="image2"><img src="graphics/e0099-01.jpg" alt="image"/></div>
<p class="indent">Let&#8217;s write a program that will ask a user to input a number, <em>n</em>, and print this series for that number. In the series, <em>x</em> is a symbol and <em>n</em> is an integer input by the program&#8217;s user. The <em>n</em>th term in this series is given by</p>
<div class="image2"><img src="graphics/e0099-02.jpg" alt="image"/></div>
<p class="indent">We can print this series using the following program:</p>
<p class="programs">&#160;&#160;&#160;'''<br/>
&#160;&#160;&#160;Print&#160;the&#160;series:<br/>
&#160;&#160;&#160;x&#160;+&#160;x**2&#160;+&#160;x**3&#160;+&#160;...&#160;+&#160;x**n<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;____&#160;&#160;_____&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_____<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;2&#160;&#160;&#160;&#160;3&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;n<br/>
&#160;&#160;&#160;'''<br/>
<br/>
&#160;&#160;&#160;from&#160;sympy&#160;import&#160;Symbol,&#160;pprint,&#160;init_printing<br/>
&#160;&#160;&#160;def&#160;print_series(n):<br/>
<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;#&#160;Initialize&#160;printing&#160;system&#160;with&#160;reverse&#160;order<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;init_printing(order='rev-lex')<br/>
<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;x&#160;=&#160;Symbol('x')<br/>
<span class="ent">&#x278A;</span>&#160;&#160;&#160;&#160;&#160;series&#160;=&#160;x<br/>
<span class="ent">&#x278B;</span>&#160;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(2,&#160;n+1):<br/>
<span class="ent">&#x278C;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;series&#160;=&#160;series&#160;+&#160;(x**i)/i<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;pprint(series)<br/>
<br/>
&#160;&#160;&#160;if&#160;__name__&#160;==&#160;'__main__':<br/>
&#160;&#160;&#160;&#160;&#160;&#160;&#160;n&#160;=&#160;input('Enter&#160;the&#160;number&#160;of&#160;terms&#160;you&#160;want&#160;in&#160;the&#160;series:&#160;')<br/>
<span class="ent">&#x278D;</span>&#160;&#160;&#160;&#160;&#160;print_series(int(n))</p>
<p class="indent">The <span class="literal">print_series()</span> function accepts an integer, <span class="literal">n</span>, as a parameter that is the number of terms in the series that will be printed. Note that we convert the input to an integer using the <span class="literal">int()</span> function when calling the function at <span class="ent">&#x278D;</span>. We then call the <span class="literal">init_printing()</span> function to set the series to print in reverse lexicographical order.</p>
<p class="indent">At <span class="ent">&#x278A;</span>, we create the label, <span class="literal">series</span>, and set its initial value as <span class="literal">x</span>. Then, we define a <span class="literal">for</span> loop that will iterate over the integers from 2 to <span class="literal">n</span> at <span class="ent">&#x278B;</span>. Each time the loop iterates, it adds each term to <span class="literal">series</span> at <span class="ent">&#x278C;</span>, as follows:</p>
<p class="programs">i&#160;=&#160;2,&#160;series&#160;=&#160;x&#160;+&#160;x**2&#160;/&#160;2<br/>i&#160;=&#160;3,&#160;series&#160;=&#160;x&#160;+&#160;x**2/2&#160;+&#160;x**3/3<br/><br/>--<span class="codeitalic">snip</span>--</p>
<p class="indent"><a id="page_100"/>The value of <span class="literal">series</span> starts off as just plain <span class="literal">x</span>, but with each iteration, <span class="literal">x**i/i</span> gets added to the value of <span class="literal">series</span> until the series we want is completed. You can see SymPy addition put to good use here. Finally, the <span class="literal">pprint()</span> function is used to print the series.</p>
<p class="indent">When you run the program, it asks you to input a number and then prints the series up to that term:</p>
<p class="programs">Enter&#160;the&#160;number&#160;of&#160;terms&#160;you&#160;want&#160;in&#160;the&#160;series:&#160;<span class="codestrong">5</span><br/><br/>&#160;&#160;&#160;&#160;x<sup>2</sup>&#160;x<sup>3</sup>&#160;x<sup>4</sup>&#160;x<sup>5</sup><br/>x&#160;+&#160;--&#160;+&#160;--&#160;+&#160;--&#160;+&#160;--<br/>&#160;&#160;&#160;&#160;2&#160;&#160;&#160;&#160;3&#160;&#160;&#160;&#160;4&#160;&#160;&#160;&#160;5</p>
<p class="indent">Try this out with a different number of terms every time. Next, we&#8217;ll see how to calculate the sum of this series for a certain value of <em>x</em>.</p>
<h4 class="h4" id="ch04lev2sec03"><strong><em>Substituting in Values</em></strong></h4>
<p class="noindent">Let&#8217;s see how we can use SymPy to plug values into an algebraic expression. This will let us calculate the value of the expression for certain values of the variables. Consider the mathematical expression <em>x</em><sup>2</sup> + 2<em>xy</em> + <em>y</em><sup>2</sup>, which can be defined as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">y&#160;=&#160;Symbol('y')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x*x&#160;+&#160;x*y&#160;+&#160;x*y&#160;+&#160;y*y</span><br/>x**2&#160;+&#160;2*x*y&#160;+&#160;y**2</p>
<p class="indent">If you want to evaluate this expression, you can substitute numbers in for the symbols using the <span class="literal">subs()</span> method:</p>
<p class="programs"><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x*x&#160;+&#160;x*y&#160;+&#160;x*y&#160;+&#160;y*y</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">res&#160;=&#160;expr.subs({x:1,&#160;y:2})</span></p>
<p class="indent">First, we create a new label to refer to the expression at <span class="ent">&#x278A;</span>, and then we call the <span class="literal">subs()</span> method. The argument to the <span class="literal">subs()</span> method is a Python <em>dictionary</em>, which contains the two symbol labels and the numerical values we want to substitute in for each symbol. Let&#8217;s check out the result:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">res</span><br/>9</p>
<p class="indent">You can also express one symbol in terms of another and substitute accordingly, using the <span class="literal">subs()</span> method. For example, if you knew that <em>x</em> = 1 &#8211; <em>y</em>, here&#8217;s how you could evaluate the preceding expression:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr.subs({x:1-y})</span><br/>y**2&#160;+&#160;2*y*(-y&#160;+&#160;1)&#160;+&#160;(-y&#160;+&#160;1)**2</p>
<div class="sidebar">
<p class="sidebart"><a id="page_101"/><strong>PYTHON DICTIONARIES</strong></p>
<p class="noindent">A dictionary is another type of data structure in Python (lists and tuples are other examples of data structures, which you&#8217;ve seen earlier). Dictionaries contain key-value pairs inside curly braces, where each key is matched up with a value, separated by a colon. In the preceding code listing, we entered the dictionary <span class="literal">{x:1, y:2}</span> as an argument to the <span class="literal">subs()</span> method. This dictionary has two key-value pairs&#8212;<span class="literal">x:1</span> and <span class="literal">y:2</span>, where <span class="literal">x</span> and <span class="literal">y</span> are the keys and <span class="literal">1</span> and <span class="literal">2</span> are the corresponding values. You can retrieve a value from a dictionary by entering its associated key in brackets, much as we would retrieve an element from a list using its index. For example, here we create a simple dictionary and then retrieve the value corresponding to <span class="literal">key1</span>:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">sampledict&#160;=&#160;{"key1":&#160;5,&#160;"key2":&#160;20}</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">sampledict["key1"]</span><br/>5</p>
<p class="indent">To learn more about dictionaries, see <a href="app02.html#app02">Appendix B</a>.</p>
</div>
<p class="indent">If you want the result to be simplified further&#8212;for example, if there are terms that cancel each other out, we can use SymPy&#8217;s <span class="literal">simplify()</span> function, as follows:</p>
<p class="programs"><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr_subs&#160;=&#160;expr.subs({x:1-y})</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;simplify</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">simplify(expr_subs)</span><br/>&#160;&#160;&#160;1</p>
<p class="indent">At <span class="ent">&#x278A;</span>, we create a new label, <span class="literal">expr_subs</span>, to refer to the result of substituting <em>x</em> = 1 &#8211; <em>y</em> in the expression. We then import the <span class="literal">simplify()</span> function from SymPy and call it at <span class="ent">&#x278B;</span>. The result turns out to be 1 because the other terms of the expression cancel each other.</p>
<p class="indent">Although there was a simplified version of the expression in the preceding example, you had to ask SymPy to simplify it using the <span class="literal">simplify()</span> function. Once again, this is because SymPy won&#8217;t do any simplification without being asked to.</p>
<p class="indent">The <span class="literal">simplify()</span> function can also simplify complicated expressions, such as those including logarithms and trigonometric functions, but we won&#8217;t get into that here.</p>
<h5 class="h5" id="ch04lev3sec02"><a id="page_102"/><strong>Calculating the Value of a Series</strong></h5>
<p class="noindent">Let&#8217;s revisit the series-printing program. In addition to printing the series, we want our program to be able to find the value of the series for a particular value of <em>x</em>. That is, our program will now take two inputs from the user&#8212;the number of terms in the series and the value of <em>x</em> for which the value of the series will be calculated. Then, the program will output both the series and the sum. The following program extends the series printing program to include these enhancements:</p>
<p class="programs">&#160;&#160;&#160;'''<br/>&#160;&#160;&#160;Print&#160;the&#160;series:<br/>&#160;&#160;&#160;x&#160;+&#160;x**2&#160;+&#160;x**3&#160;+&#160;...&#160;+&#160;x**n<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;____&#160;&#160;_____&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;_____<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;2&#160;&#160;&#160;&#160;&#160;3&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;n<br/>&#160;&#160;&#160;'''<br/><br/>&#160;&#160;&#160;from&#160;sympy&#160;import&#160;Symbol,&#160;pprint,&#160;init_printing<br/>&#160;&#160;&#160;def&#160;print_series(n,&#160;x_value):<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;#&#160;Initialize&#160;printing&#160;system&#160;with&#160;reverse&#160;order<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;init_printing(order='rev-lex')<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;x&#160;=&#160;Symbol('x')<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;series&#160;=&#160;x<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;for&#160;i&#160;in&#160;range(2,&#160;n+1):<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;series&#160;=&#160;series&#160;+&#160;(x**i)/i<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;pprint(series)<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;#&#160;Evaluate&#160;the&#160;series&#160;at&#160;x_value<br/><span class="ent">&#x278A;</span>&#160;&#160;&#160;&#160;&#160;series_value&#160;=&#160;series.subs({x:x_value})<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;print('Value&#160;of&#160;the&#160;series&#160;at&#160;{0}:&#160;{1}'.format(x_value,&#160;series_value))<br/><br/>&#160;&#160;&#160;if&#160;__name__&#160;==&#160;'__main__':<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;n&#160;=&#160;input('Enter&#160;the&#160;number&#160;of&#160;terms&#160;you&#160;want&#160;in&#160;the&#160;series:&#160;')<br/><span class="ent">&#x278B;</span>&#160;&#160;&#160;&#160;&#160;x_value&#160;=&#160;input('Enter&#160;the&#160;value&#160;of&#160;x&#160;at&#160;which&#160;you&#160;want&#160;to&#160;evaluate&#160;the&#160;series:&#160;')<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;print_series(int(n),&#160;float(x_value))</p>
<p class="indent">The <span class="literal">print_series()</span> function now takes an additional argument, <span class="literal">x_value</span>, which is the value of <span class="literal">x</span> for which the series should be evaluated. At <span class="ent">&#x278A;</span>, we use the <span class="literal">subs()</span> method to perform the evaluation and the label <span class="literal">series_value</span> to refer to the result. In the next line, we display the result.</p>
<p class="indent">The additional input statement at <span class="ent">&#x278B;</span> asks the user to enter the value of <span class="literal">x</span> using the label <span class="literal">x_value</span> to refer to it. Before we call the <span class="literal">print_series()</span> function, we convert this value into its floating point equivalent using the <span class="literal">float()</span> function.</p>
<p class="indent"><a id="page_103"/>If you execute the program now, it will ask you for the two inputs and print out the series and the series value:</p>
<p class="programs">Enter&#160;the&#160;number&#160;of&#160;terms&#160;you&#160;want&#160;in&#160;the&#160;series:&#160;<span class="codestrong">5</span><br/>Enter&#160;the&#160;value&#160;of&#160;x&#160;at&#160;which&#160;you&#160;want&#160;to&#160;evaluate&#160;the&#160;series:&#160;<span class="codestrong">1.2</span><br/><br/>&#160;&#160;&#160;&#160;x<sup>2</sup>&#160;x<sup>3</sup>&#160;x<sup>4</sup>&#160;x<sup>5</sup><br/>x&#160;+&#160;--&#160;+&#160;--&#160;+&#160;--&#160;+&#160;--<br/>&#160;&#160;&#160;&#160;2&#160;&#160;&#160;&#160;3&#160;&#160;&#160;&#160;4&#160;&#160;&#160;&#160;5<br/>Value&#160;of&#160;the&#160;series&#160;at&#160;1.2:&#160;3.51206400000000</p>
<p class="indent">In this sample run, we ask for five terms in the series, with <span class="literal">x</span> set to 1.2, and the program prints and evaluates the series.</p>
<h4 class="h4" id="ch04lev2sec04"><strong><em>Converting Strings to Mathematical Expressions</em></strong></h4>
<p class="noindent">So far, we&#8217;ve been writing out individual expressions each time we want to do something with them. However, what if you wanted to write a more general program that could manipulate any expression provided by the user? For that, we need a way to convert a user&#8217;s input, which is a string, into something we can perform mathematical operations on. SymPy&#8217;s <span class="literal">sympify()</span> function helps us do exactly that. The function is so called because it converts the string into a SymPy object that makes it possible to apply SymPy&#8217;s functions to the input. Let&#8217;s see an example:</p>
<p class="programs"><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;sympify</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;input('Enter&#160;a&#160;mathematical&#160;expression:&#160;')</span><br/>&#160;&#160;&#160;Enter&#160;a&#160;mathematical&#160;expression:&#160;<span class="codestrong">x**2&#160;+&#160;3*x&#160;+&#160;x**3&#160;+&#160;2*x</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;sympify(expr)</span></p>
<p class="indent">We first import the <span class="literal">sympify()</span> function at <span class="ent">&#x278A;</span>. We then use the <span class="literal">input()</span> function to ask for a mathematical expression as input, using the label <span class="literal">expr</span> to refer to it. Next, we call the <span class="literal">sympify()</span> function with <span class="literal">expr</span> as its argument at <span class="ent">&#x278B;</span> and use the same label to refer to the converted expression.</p>
<p class="indent">You can perform various operations on this expression. For example, let&#8217;s try multiplying the expression by 2:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">2*expr</span><br/>2*x**3&#160;+&#160;2*x**2&#160;+&#160;10*x</p>
<p class="indent">What happens when the user supplies an invalid expression? Let&#8217;s see:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;input('Enter&#160;a&#160;mathematical&#160;expression:&#160;')</span><br/>Enter&#160;a&#160;mathematical&#160;expression:&#160;<span class="codestrong">x**2&#160;+&#160;3*x&#160;+&#160;x**3&#160;+&#160;2x</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;sympify(expr)</span><br/>Traceback&#160;(most&#160;recent&#160;call&#160;last):<br/>&#160;&#160;File&#160;"&lt;pyshell#146&gt;",&#160;line&#160;1,&#160;in&#160;&lt;module&gt;<br/>&#160;&#160;&#160;&#160;expr&#160;=&#160;sympify(expr)<br/>&#160;&#160;File&#160;"/usr/lib/python3.3/site-packages/sympy/core/sympify.py",&#160;line&#160;180,&#160;in&#160;sympify<br/>&#160;&#160;&#160;&#160;raise&#160;SympifyError('could&#160;not&#160;parse&#160;%r'&#160;%&#160;a)<br/>sympy.core.sympify.SympifyError:&#160;SympifyError:&#160;"could&#160;not&#160;parse&#160;'x**2&#160;+&#160;3*x&#160;+&#160;x**3&#160;+&#160;2x'"</p>
<p class="indent"><a id="page_104"/>The last line tells us that <span class="literal">sympify()</span> isn&#8217;t able to convert the supplied input expression. Because this user didn&#8217;t add an operator between <span class="literal">2</span> and <span class="literal">x</span>, SymPy doesn&#8217;t understand what it means. Your program should expect such invalid input and print an error message if it comes up. Let&#8217;s see how we can do that by catching the <span class="literal">SympifyError</span> exception:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;sympify</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy.core.sympify&#160;import&#160;SympifyError</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;input('Enter&#160;a&#160;mathematical&#160;expression:&#160;')</span><br/>Enter&#160;a&#160;mathematical&#160;expression:&#160;<span class="codestrong">x**2&#160;+&#160;3*x&#160;+&#160;x**3&#160;+&#160;2x</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">try:</span><br/>&#160;&#160;&#160;&#160;<span class="codestrong">expr&#160;=&#160;sympify(expr)</span><br/><span class="codestrong">except&#160;SympifyError:</span><br/>&#160;&#160;&#160;&#160;<span class="codestrong">print('Invalid&#160;input')</span><br/><br/>Invalid&#160;input</p>
<p class="indent">The two changes in the preceding program are that we import the <span class="literal">SympifyError</span> exception class from the <span class="literal">sympy.core.sympify</span> module and call the <span class="literal">sympify()</span> function in a <span class="literal">try...except</span> block. Now if there&#8217;s a <span class="literal">SympifyError</span> exception, an error message is printed.</p>
<h5 class="h5" id="ch04lev3sec03"><strong>Expression Multiplier</strong></h5>
<p class="noindent">Let&#8217;s apply the <span class="literal">sympify()</span> function to write a program that calculates the product of two expressions:</p>
<p class="programs">&#160;&#160;&#160;'''<br/>&#160;&#160;&#160;Product&#160;of&#160;two&#160;expressions<br/>&#160;&#160;&#160;'''<br/><br/>&#160;&#160;&#160;from&#160;sympy&#160;import&#160;expand,&#160;sympify<br/>&#160;&#160;&#160;from&#160;sympy.core.sympify&#160;import&#160;SympifyError<br/><br/>&#160;&#160;&#160;def&#160;product(expr1,&#160;expr2):<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;prod&#160;=&#160;expand(expr1*expr2)<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;print(prod)<br/><br/>&#160;&#160;&#160;if&#160;__name__=='__main__':<br/><span class="ent">&#x278A;</span>&#160;&#160;&#160;&#160;&#160;expr1&#160;=&#160;input('Enter&#160;the&#160;first&#160;expression:&#160;')<br/><span class="ent">&#x278B;</span>&#160;&#160;&#160;&#160;&#160;expr2&#160;=&#160;input('Enter&#160;the&#160;second&#160;expression:&#160;')<br/><br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;try:<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;expr1&#160;=&#160;sympify(expr1)<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;expr2&#160;=&#160;sympify(expr2)<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;except&#160;SympifyError:<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print('Invalid&#160;input')<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;else:<br/><span class="ent">&#x278C;</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;product(expr1,&#160;expr2)</p>
<p class="indent">At <span class="ent">&#x278A;</span> and <span class="ent">&#x278B;</span>, we ask the user to enter the two expressions. Then, we convert them into a form understood by SymPy using the <span class="literal">sympify()</span> function <a id="page_105"/>in a <span class="literal">try...except</span> block. If the conversion succeeds (indicated by the <span class="literal">else</span> block), we call the <span class="literal">product()</span> function at <span class="ent">&#x278C;</span>. In this function, we calculate the product of the two expressions and print it. Note how we use the <span class="literal">expand()</span> function to print the product so that all its terms are expressed as a sum of its constituent terms.</p>
<p class="indent">Here&#8217;s a sample execution of the program:</p>
<p class="programs">Enter&#160;the&#160;first&#160;expression:&#160;<span class="codestrong">x**2&#160;+&#160;x*2&#160;+&#160;x</span><br/>Enter&#160;the&#160;second&#160;expression:&#160;<span class="codestrong">x**3&#160;+&#160;x*3&#160;+&#160;x</span><br/>x**5&#160;+&#160;3*x**4&#160;+&#160;4*x**3&#160;+&#160;12*x**2</p>
<p class="indent">The last line displays the product of the two expressions. The input can also have more than one symbol in any of the expressions:</p>
<p class="programs">Enter&#160;the&#160;first&#160;expression:&#160;<span class="codestrong">x*y+x</span><br/>Enter&#160;the&#160;second&#160;expression:&#160;<span class="codestrong">x*x+y</span><br/>x**3*y&#160;+&#160;x**3&#160;+&#160;x*y**2&#160;+&#160;x*y</p>
<h3 class="h3" id="ch04lev1sec03"><strong>Solving Equations</strong></h3>
<p class="noindent">SymPy&#8217;s <span class="literal">solve()</span> function can be used to find solutions to equations. When you input an expression with a symbol representing a variable, such as <em>x</em>, <span class="literal">solve()</span> calculates the value of that symbol. This function always makes its calculation by assuming the expression you enter is equal to zero&#8212;that is, it prints the value that, when substituted for the symbol, makes the entire expression equal zero. Let&#8217;s start with the simple equation <em>x</em> &#8211; 5 = 7. If we want to use <span class="literal">solve()</span> to find the value of <span class="literal">x</span>, we first have to make one side of the equation equal zero (<em>x</em> &#8211; 5 &#8211; 7 = 0). Then, we&#8217;re ready to use <span class="literal">solve()</span>, as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol,&#160;solve</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x&#160;-&#160;5&#160;-&#160;7</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">solve(expr)</span><br/>[12]</p>
<p class="indent">When we use <span class="literal">solve()</span>, it calculates the value of <span class="literal">'x'</span> as 12 because that&#8217;s the value that makes the expression (<em>x</em> &#8211; 5 &#8211; 7) equal to zero.</p>
<p class="indent">Note that the result 12 is returned in a list. An equation can have multiple solutions&#8212;for example, a quadratic equation has two solutions. In that case, the list will have all the solutions as its members. You can also ask the <span class="literal">solve()</span> function to return the result so that each member is dictionary instead. Each dictionary is composed of the symbol (variable name) and its value (the solution). This is especially useful when solving simultaneous equations where we have more than one variable to solve for because when the solution is returned as a dictionary, we know which solution corresponds to which variable.</p>
<h4 class="h4" id="ch04lev2sec05"><a id="page_106"/><strong><em>Solving Quadratic Equations</em></strong></h4>
<p class="noindent">In <a href="ch01.html#ch01">Chapter 1</a>, we found the roots of the quadratic equation <em>ax</em><sup>2</sup> + <em>bx</em> + <em>c</em> = 0 by writing the formulas for the two roots and then substituting the values of the constants <em>a</em>, <em>b</em>, and <em>c</em>. Now, we&#8217;ll learn how we can use SymPy&#8217;s <span class="literal">solve()</span> function to find the roots without needing to write out the formulas. Let&#8217;s see an example:</p>
<p class="programs"><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;solve</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x**2&#160;+&#160;5*x&#160;+&#160;4</span><br/><span class="ent">&#x278C;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">solve(expr,&#160;dict=True)</span><br/><span class="ent">&#x278D;</span>&#160;[{x:&#160;-4},&#160;{x:&#160;-1}]</p>
<p class="indent">The <span class="literal">solve()</span> function is first imported at <span class="ent">&#x278A;</span>. We then define a symbol, <span class="literal">x</span>, and an expression corresponding to the quadratic equation, <span class="literal">x**2 + 5*x + 4</span>, at <span class="ent">&#x278B;</span>. Then, we call the <span class="literal">solve()</span> function with the preceding expression at <span class="ent">&#x278C;</span>. The second argument to the <span class="literal">solve()</span> function (<span class="literal">dict=True</span>) specifies that we want the result to be returned as a list of Python dictionaries.</p>
<p class="indent">Each solution in the returned list is a dictionary using the symbol as a key matched with its corresponding value. If the solution is empty, an empty list will be returned. The roots of the preceding equation are &#8211;4 and &#8211;1, as you can see at <span class="ent">&#x278D;</span>.</p>
<p class="indentb">We found out in the first chapter that the roots of the equation</p>
<p class="center"><em>x</em><sup>2</sup> + <em>x</em> + 1 = 0</p>
<p class="noindentt">are complex numbers. Let&#8217;s attempt to find those using <span class="literal">solve()</span>:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x=Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x**2&#160;+&#160;x&#160;+&#160;1</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">solve(expr,&#160;dict=True)</span><br/>[{x:&#160;-1/2&#160;-&#160;sqrt(3)*I/2},&#160;{x:&#160;-1/2&#160;+&#160;sqrt(3)*I/2}]</p>
<p class="indent">Both the roots are imaginary, as expected with the imaginary component indicated by the <span class="literal">I</span> symbol.</p>
<h4 class="h4" id="ch04lev2sec06"><strong><em>Solving for One Variable in Terms of Others</em></strong></h4>
<p class="noindent">In addition to finding the roots of equations, we can take advantage of symbolic math to use the <span class="literal">solve()</span> function to express one variable in an equation in terms of the others. Let&#8217;s take a look at finding the roots for the generic quadratic equation <em>ax</em><sup>2</sup> + <em>bx</em> + <em>c</em> = 0. To do so, we&#8217;ll define <em>x</em> and three additional symbols&#8212;<em>a</em>, <em>b</em>, and <em>c</em>, which correspond to the three constants:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">a&#160;=&#160;Symbol('a')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">b&#160;=&#160;Symbol('b')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">c&#160;=&#160;Symbol('c')</span></p>
<p class="indent"><a id="page_107"/>Next, we write the expression corresponding to the equation and use the <span class="literal">solve()</span> function on it:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;a*x*x&#160;+&#160;b*x&#160;+&#160;c</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">solve(expr,&#160;x,&#160;dict=True)</span><br/>[{x:&#160;(-b&#160;+&#160;sqrt(-4*a*c&#160;+&#160;b**2))/(2*a)},&#160;{x:&#160;-(b&#160;+&#160;sqrt(-4*a*c&#160;+&#160;b**2))/(2*a)}]</p>
<p class="indent">Here, we have to include an additional argument, <span class="literal">x</span>, to the <span class="literal">solve()</span> function. Because there&#8217;s more than one symbol in the equation, we need to tell <span class="literal">solve()</span> which symbol it should solve for, which is what we indicate by passing in <span class="literal">x</span> as the second argument. As we&#8217;d expect, <span class="literal">solve()</span> prints the quadratic formula: the generic formula for finding the value(s) of <em>x</em> in a polynomial expression.</p>
<p class="indent">To be clear, when we use <span class="literal">solve()</span> on an equation with more than one symbol, we specify the symbol to solve for as the second argument (and now the third argument specifies how we want the results to be returned).</p>
<p class="indent">Next, let&#8217;s consider an example from physics. According to one of the equations of motion, the distance traveled by a body moving with a constant acceleration <em>a</em>, with an initial velocity <em>u</em>, in time <em>t</em>, is given by</p>
<div class="image2"><img src="graphics/e0107-01.jpg" alt="image"/></div>
<p class="indent">Given <em>u</em> and <em>a</em>, however, if you wanted to find the time required to travel a given distance, <em>s</em>, you&#8217;d have to first express <em>t</em> in terms of the other variables. Here&#8217;s how you could do that using SymPy&#8217;s <span class="literal">solve()</span> function:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol,&#160;solve,&#160;pprint</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">s&#160;=&#160;Symbol('s')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">u&#160;=&#160;Symbol('u')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">t&#160;=&#160;Symbol('t')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">a&#160;=&#160;Symbol('a')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;u*t&#160;+&#160;(1/2)*a*t*t&#160;-&#160;s</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">t_expr&#160;=&#160;solve(expr,t,&#160;dict=True)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">pprint(t_expr)</span></p>
<p class="indent">The result looks like this:</p>
<div class="image2"><img src="graphics/f0107-01.jpg" alt="image"/></div>
<p class="indent">Now that we have the expression for <em>t</em> (referred to by the label <span class="literal">t_expr</span>), we can use the <span class="literal">subs()</span> method to replace the values of <em>s</em>, <em>u</em>, and <em>a</em> to find the two possible values of <em>t</em>.</p>
<h4 class="h4" id="ch04lev2sec07"><a id="page_108"/><strong><em>Solving a System of Linear Equations</em></strong></h4>
<p class="noindentb">Consider the following two equations:</p>
<p class="center">2<em>x</em> + 3<em>y</em> = 6</p>
<p class="center">3<em>x</em> + 2<em>y</em> = 12</p>
<p class="indentt">Say we want to find the pair of values (<em>x</em>, <em>y</em>) that satisfies both the equations. We can use the <span class="literal">solve()</span> function to find the solution for a system of equations like this one.</p>
<p class="indent">First, we define the two symbols and create the two equations:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">y&#160;=&#160;Symbol('y')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr1&#160;=&#160;2*x&#160;+&#160;3*y&#160;-&#160;6</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr2&#160;=&#160;3*x&#160;+&#160;2*y&#160;&#8211;&#160;12</span></p>
<p class="indent">The two equations are defined by the expressions <span class="literal">expr1</span> and <span class="literal">expr2</span>, respectively. Note how we&#8217;ve rearranged the expressions so they both equal zero (we moved the right side of the given equations to the left side). To find the solution, we call the <span class="literal">solve()</span> function with the two expressions forming a tuple:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">solve((expr1,&#160;expr2),&#160;dict=True)</span><br/>[{y:&#160;-6/5,&#160;x:&#160;24/5}]</p>
<p class="indent">As I mentioned earlier, getting the solution back as a dictionary is useful here. We can see that the value of <span class="literal">x</span> is 24/5 and the value of <span class="literal">y</span> is &#8211;6/5. Let&#8217;s verify whether the solution we got really satisfies the equations. To do so, we&#8217;ll first create a label, <span class="literal">soln</span>, to refer to the solution we got and then use the <span class="literal">subs()</span> method to substitute the corresponding values of <span class="literal">x</span> and <span class="literal">y</span> in the two expressions:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">soln&#160;=&#160;solve((expr1,&#160;expr2),&#160;dict=True)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">soln&#160;=&#160;soln[0]</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr1.subs({x:soln[x],&#160;y:soln[y]})</span><br/>0<br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr2.subs({x:soln[x],&#160;y:soln[y]})</span><br/>0</p>
<p class="indent">The result of substituting the values of <span class="literal">x</span> and <span class="literal">y</span> corresponding to the solution in the two expressions is zero.</p>
<h3 class="h3" id="ch04lev1sec04"><strong>Plotting Using SymPy</strong></h3>
<p class="noindent">In <a href="ch02.html#ch02">Chapter 2</a>, we learned to make graphs where we explicitly specified the numbers we wanted to plot. For example, to plot the graph of the gravitational force against the distance between two bodies, you had to calculate <a id="page_109"/>the gravitational force for each distance value and supply the lists of distances and forces to matplotlib. With SymPy, on the other hand, you can just tell SymPy the equation of the line you want to plot, and the graph will be created for you. Let&#8217;s plot a line whose equation is given by <em>y</em> = 2<em>x</em> + 3:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy.plotting&#160;import&#160;plot</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">plot(2*x+3)</span></p>
<p class="indent">All we had to do was import <span class="literal">plot</span> and <span class="literal">Symbol</span> from <span class="literal">sympy.plotting</span>, create a symbol, <span class="literal">x</span>, and call the <span class="literal">plot()</span> function with the expression <span class="literal">2*x+3</span>. SymPy takes care of everything else and plots the graph of the function, as shown in <a href="ch04.html#ch4fig1">Figure 4-1</a>.</p>
<div class="image"><img src="graphics/f04-01.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig1"/><em>Figure 4-1: Plot of the line</em> y = <em>2</em>x + <em>3</em></p>
<p class="indent">The graph shows that a default range of <em>x</em> values was automatically chosen: &#8211;10 to 10. You may notice that the graph window looks very similar to those you saw in <a href="ch02.html#ch02">Chapters 2</a> and <a href="ch03.html#ch03">3</a>. That&#8217;s because SymPy uses matplotlib behind the scenes to draw the graphs. Also note that we didn&#8217;t have to call the <span class="literal">show()</span> function to show the graphs because this is done automatically by SymPy.</p>
<p class="indent"><a id="page_110"/>Now, let&#8217;s say that you wanted to limit the values of <span class="literal">'x'</span> in the preceding graph to lie in the range &#8211;5 to 5 (instead of &#8211;10 to 10). You&#8217;d do that as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">plot((2*x&#160;+&#160;3),&#160;(x,&#160;-5,&#160;5))</span></p>
<p class="indent">Here, a tuple consisting of the symbol, the lower bound, and the upper bound of the range&#8212;<span class="literal">(x, -5, 5)</span>&#8212;is specified as the second argument to the <span class="literal">plot()</span> function. Now, the graph displays only the values of <em>y</em> corresponding to the values of <em>x</em> between &#8211;5 and 5 (see <a href="ch04.html#ch4fig2">Figure 4-2</a>).</p>
<div class="image"><img src="graphics/f04-02.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig2"/><em>Figure 4-2: Plot of the line</em> y = <em>2</em>x + <em>3 with the values of</em> x <em>restricted to the range &#8211;5 to 5</em></p>
<p class="indent">You can use other keyword arguments in the <span class="literal">plot()</span> function, such as <span class="literal">title</span> to enter a title or <span class="literal">xlabel</span> and <span class="literal">ylabel</span> to label the <em>x</em>-axis and the <em>y</em>-axis, respectively. The following <span class="literal">plot()</span> function specifies the preceding three keyword arguments (see the corresponding graph in <a href="ch04.html#ch4fig3">Figure 4-3</a>):</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">plot(2*x&#160;+&#160;3,&#160;(x,&#160;-5,&#160;5),&#160;title='A&#160;Line',&#160;xlabel='x',&#160;ylabel='2x+3')</span></p>
<div class="image"><a id="page_111"/><img src="graphics/f04-03.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig3"/><em>Figure 4-3: Plot of the line</em> y = <em>2</em>x + <em>3 with the range of</em> x <em>and other attributes specified</em></p>
<p class="indent">The plot shown in <a href="ch04.html#ch4fig3">Figure 4-3</a> now has a title and labels on the <em>x</em>-axis and the <em>y</em>-axis. You can specify a number of other keyword arguments to the <span class="literal">plot()</span> function to customize the behavior of the function as well as the graph itself. The <span class="literal">show</span> keyword argument allows us to specify whether we want the graph to be displayed. Passing <span class="literal">show=False</span> will cause the graph to not be displayed when you call the <span class="literal">plot()</span> function:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">p&#160;=&#160;plot(2*x&#160;+&#160;3,&#160;(x,&#160;-5,&#160;5),&#160;title='A&#160;Line',&#160;xlabel='x',&#160;ylabel='2x+3',&#160;show=False)</span></p>
<p class="indent">You will see that no graph is shown. The label <span class="literal">p</span> refers to the plot that is created, so you can now call <span class="literal">p.show()</span> to display the graph. You can also save the graph as an image file using the <span class="literal">save()</span> method, as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">p.save('line.png')</span></p>
<p class="indent">This will save the plot to a file <em>line.png</em> in the current directory.</p>
<h4 class="h4" id="ch04lev2sec08"><strong><em>Plotting Expressions Input by the User</em></strong></h4>
<p class="noindent">The expression that you pass to the <span class="literal">plot()</span> function must be expressed in terms of <em>x</em> only. For example, earlier we plotted <em>y</em> = 2<em>x</em> + 3, which we entered to the plot function as simply 2<em>x</em> + 3. If the expression were not originally in this form, we&#8217;d have to rewrite it. Of course, we could do this manually, <a id="page_112"/>outside the program. But what if you want to write a program that allows its users to graph any expression? If the user enters an expression in the form of 2<em>x</em> + 3<em>y</em> &#8211; 6, say, we have to first convert it. The <span class="literal">solve()</span> function will help us here. Let&#8217;s see an example:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;input('Enter&#160;an&#160;expression:&#160;')</span><br/>&#160;&#160;&#160;Enter&#160;an&#160;expression:&#160;<span class="codestrong">2*x&#160;+&#160;3*y&#160;-&#160;6</span><br/><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;sympify(expr)</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">y&#160;=&#160;Symbol('y')</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">solve(expr,&#160;y)</span><br/><span class="ent">&#x278C;</span>&#160;[-2*x/3&#160;+&#160;2]</p>
<p class="indent">At <span class="ent">&#x278A;</span>, we use the <span class="literal">sympify()</span> function to convert the input expression to a SymPy object. At <span class="ent">&#x278B;</span>, we create a <span class="literal">Symbol</span> object to represent <span class="literal">'y'</span> so that we can tell SymPy which variable we want to solve the equation for. Then we solve the expression to find <span class="literal">y</span> in terms of <span class="literal">x</span> by specifying <span class="literal">y</span> as the second argument to the <span class="literal">solve()</span> function. At <span class="ent">&#x278C;</span>, this returns the equation in terms of <span class="literal">x</span>, which is what we need for plotting.</p>
<p class="indent">Notice that this final expression is stored in a list, so before we can use it, we&#8217;ll have to extract it from the list:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">solutions&#160;=&#160;solve(expr,&#160;'y')</span><br/><span class="ent">&#x278D;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr_y&#160;=&#160;solutions[0]</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">expr_y</span><br/>&#160;&#160;&#160;-2*x/3&#160;+&#160;2</p>
<p class="indent">We create a label, <span class="literal">solutions</span>, to refer to the result returned by the <span class="literal">solve()</span> function, which is a list with only one item. Then, we extract that item at <span class="ent">&#x278D;</span>. Now, we can call the <span class="literal">plot()</span> function to graph the expression. The next listing shows a full graph-drawing program:</p>
<p class="programs">'''<br/>Plot&#160;the&#160;graph&#160;of&#160;an&#160;input&#160;expression<br/>'''<br/><br/>from&#160;sympy&#160;import&#160;Symbol,&#160;sympify,&#160;solve, SympifyError<br/>from&#160;sympy.plotting&#160;import&#160;plot<br/><br/>def&#160;plot_expression(expr):<br/><br/>&#160;&#160;&#160;&#160;y&#160;=&#160;Symbol('y')<br/>&#160;&#160;&#160;&#160;solutions&#160;=&#160;solve(expr,&#160;y)<br/>&#160;&#160;&#160;&#160;expr_y&#160;=&#160;solutions[0]<br/>&#160;&#160;&#160;&#160;plot(expr_y)<br/><br/>if&#160;__name__=='__main__':<br/><br/>&#160;&#160;&#160;&#160;expr&#160;=&#160;input('Enter&#160;your&#160;expression&#160;in&#160;terms&#160;of&#160;x&#160;and&#160;y:&#160;')<br/><a id="page_113"/><br/>&#160;&#160;&#160;&#160;try:<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;expr&#160;=&#160;sympify(expr)<br/>&#160;&#160;&#160;&#160;except&#160;SympifyError:<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;print('Invalid&#160;input')<br/>&#160;&#160;&#160;&#160;else:<br/>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;plot_expression(expr)</p>
<p class="indent">Note that the preceding program includes a <span class="literal">try...except</span> block to check for invalid input, as we&#8217;ve done with <span class="literal">sympify()</span> earlier. When you run the program, it asks you to input an expression, and it will create the corresponding graph.</p>
<h4 class="h4" id="ch04lev2sec09"><strong><em>Plotting Multiple Functions</em></strong></h4>
<p class="noindent">You can enter multiple expressions when calling the SymPy <span class="literal">plot</span> function to plot more than one expression on the same graph. For example, the following code plots two lines at once (see <a href="ch04.html#ch4fig4">Figure 4-4</a>):</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy.plotting&#160;import&#160;plot</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">plot(2*x+3,&#160;3*x+1)</span></p>
<div class="image"><img src="graphics/f04-04.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig4"/><em>Figure 4-4: Plotting two lines on the same graph</em></p>
<p class="indent"><a id="page_114"/>This example brings out another difference between plotting in matplotlib and in SymPy. Here, using SymPy, both lines are the same color, whereas matplotlib would have automatically made the lines different colors. To set different colors for each line with SymPy, we&#8217;ll need to perform some extra steps, as shown in the following code, which also adds a legend to the graph:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy.plotting&#160;import&#160;plot</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p&#160;=&#160;plot(2*x+3,&#160;3*x+1,&#160;legend=True,&#160;show=False)</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p[0].line_color&#160;=&#160;'b'</span><br/><span class="ent">&#x278C;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p[1].line_color&#160;=&#160;'r'</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p.show()</span></p>
<p class="indent">At <span class="ent">&#x278A;</span>, we call the <span class="literal">plot()</span> function with the equations for the two lines but pass two additional keyword arguments&#8212;<span class="literal">legend</span> and <span class="literal">show</span>. By setting the legend argument to <span class="literal">True</span>, we add a legend to the graph, as we saw in <a href="ch02.html#ch02">Chapter 2</a>. Note, however, that the text that appears in the legend will match the expressions you plotted&#8212;you can&#8217;t specify any other text. We also set <span class="literal">show=False</span> because we want to set the color of the lines before we draw the graph. The statement at <span class="ent">&#x278B;</span>, <span class="literal">p[0]</span>, refers to the first line, 2<em>x</em> + 3, and we set its attribute <span class="literal">line_color</span> to <span class="literal">'b'</span>, meaning that we want this line to be blue. Similarly, we set the color of the second plot to red using the string <span class="literal">'r'</span> <span class="ent">&#x278C;</span>. Finally, we call the <span class="literal">show()</span> to display the graph (see <a href="ch04.html#ch4fig5">Figure 4-5</a>).</p>
<div class="image"><img src="graphics/f04-05.jpg" alt="image"/></div>
<p class="figuret"><a id="ch4fig5"/><em>Figure 4-5: Plot of the two lines with each line drawn in a different color</em></p>
<p class="indent"><a id="page_115"/>In addition to red and blue, you can plot the lines in green, cyan, magenta, yellow, black, and white (using the first letter of the color in each case, except black for which you use <span class="literal">'k'</span>).</p>
<h3 class="h3" id="ch04lev1sec05"><strong>What You Learned</strong></h3>
<p class="noindent">In this chapter, you learned the basics of symbolic math using SymPy. You learned about declaring symbols, constructing expressions using symbols and mathematical operators, solving equations, and plotting graphs. You will be learning more features of SymPy in later chapters.</p>
<h3 class="h3" id="ch04lev1sec06"><strong><span class="bordera">Programming Challenges</span></strong></h3>
<p class="noindent">Here are a few programming challenges that should help you further apply what you&#8217;ve learned. You can find sample solutions at <em><a href="http://www.nostarch.com/doingmathwithpython/">http://www.nostarch.com/doingmathwithpython/</a></em>.</p>
<h4 class="h4" id="ch04lev2sec10"><strong><em>#1: Factor Finder</em></strong></h4>
<p class="noindent">You learned about the <span class="literal">factor()</span> function, which prints the factors of an expression. Now that you know how your program can handle expressions input by a user, write a program that will ask the user to input an expression, calculate its factors, and print them. Your program should be able to handle invalid input by making use of exception handling.</p>
<h4 class="h4" id="ch04lev2sec11"><strong><em>#2: Graphical Equation Solver</em></strong></h4>
<p class="noindent">Earlier, you learned how to write a program that prompts the user to input an expression such as 3<em>x</em> + 2<em>y</em> &#8211; 6 and create the corresponding graph. Write a program that asks the user for two expressions and then graphs them both, as follows:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr1&#160;=&#160;input('Enter&#160;your&#160;first&#160;expression&#160;in&#160;terms&#160;of&#160;x&#160;and&#160;y:&#160;')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr2&#160;=&#160;input('Enter&#160;your&#160;second&#160;expression&#160;in&#160;terms&#160;of&#160;x&#160;and&#160;y:&#160;')</span></p>
<p class="indent">Now, <span class="literal">expr1</span> and <span class="literal">expr2</span> will store the two expressions input by the user. You should convert both of these into SymPy objects using the <span class="literal">sympify()</span> step in a <span class="literal">try...except</span> block.</p>
<p class="indent">All you need to do from here is plot these two expressions instead of one.</p>
<p class="indent">Once you&#8217;ve completed this, enhance your program to print the solution&#8212;the pair of <em>x</em> and <em>y</em> values that satisfies both equations. This will also be the spot where the two lines on the graph intersect. (Hint: Refer to how we used the <span class="literal">solve()</span> function earlier to find the solution of a system of two linear equations.)</p>
<h4 class="h4" id="ch04lev2sec12"><a id="page_116"/><strong><em>#3: Summing a Series</em></strong></h4>
<p class="noindent">We saw how to find the sum of a series in &#8220;<a href="ch04.html#ch04lev3sec01">Printing a Series</a>&#8221; on <a href="ch04.html#page_99">page 99</a>. There, we manually added the terms of the series by looping over all the terms. Here&#8217;s a snippet from that program:</p>
<p class="programs">for&#160;i&#160;in&#160;range(2,&#160;n+1):<br/>&#160;&#160;&#160;&#160;series&#160;=&#160;series&#160;+&#160;(x**i)/i</p>
<p class="indent">SymPy&#8217;s <span class="literal">summation()</span> function can be directly used to find such summations. The following example prints the sum of the first five terms of the series we considered earlier:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol,&#160;summation,&#160;pprint</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">n&#160;=&#160;Symbol('n')</span><br/><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">s&#160;=&#160;summation(x**n/n,&#160;(n,&#160;1,&#160;5))</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">pprint(s)</span><br/>&#160;&#160;&#160;x<sup>5</sup>&#160;&#160;&#160;x<sup>4</sup>&#160;&#160;&#160;x<sup>3</sup>&#160;&#160;&#160;x<sup>2</sup><br/>&#160;&#160;&#160;--&#160;+&#160;--&#160;+&#160;--&#160;+&#160;--&#160;+&#160;x<br/>&#160;&#160;&#160;5&#160;&#160;&#160;&#160;&#160;4&#160;&#160;&#160;3&#160;&#160;&#160;&#160;&#160;2</p>
<p class="indent">We call the <span class="literal">summation()</span> function at <span class="ent">&#x278A;</span>, with the first argument being the <em>n</em>th term of the series and the second argument being a tuple that states the range of <em>n</em>. We want the sum of the first five terms here, so the second argument is <span class="literal">(n, 1, 5)</span>.</p>
<p class="indent">Once you have the sum, you can use the <span class="literal">subs()</span> method to substitute a value for <em>x</em> to find the numerical value of the sum:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">s.subs({x:1.2})</span><br/>3.51206400000000</p>
<p class="indent">Your challenge is to write a program that&#8217;s capable of finding the sum of an arbitrary series when you supply the <em>n</em>th term of the series and the number of terms in it. Here&#8217;s an example of how the program would work:</p>
<p class="programs">Enter&#160;the&#160;nth&#160;term:&#160;<span class="codestrong">a+(n-1)*d</span><br/>Enter&#160;the&#160;number&#160;of&#160;terms:&#160;<span class="codestrong">3</span><br/>3&#183;a&#160;+&#160;3&#183;d</p>
<p class="indent">In this example, the <em>n</em>th term supplied is that of an <em>arithmetic progression</em>. Starting with <span class="literal">a</span> and <span class="literal">d</span> as the <em>common difference</em>, the number of terms up to which the sum is to be calculated is 3. The sum turns out to be <span class="literal">3a + 3d</span>, which agrees with the known formula for the same.</p>
<h4 class="h4" id="ch04lev2sec13"><a id="page_117"/><strong><em>#4: Solving Single-Variable Inequalities</em></strong></h4>
<p class="noindent">You&#8217;ve seen how to solve an equation using SymPy&#8217;s <span class="literal">solve()</span> function. But SymPy is also capable of solving single-variable inequalities, such as <em>x</em> + 5 &gt; 3 and sin<em>x</em> &#8211; 0.6 &gt; 0. That is, SymPy can solve relations besides equality, like &gt;, &lt;, and so on. For this challenge, create a function, <span class="literal">isolve()</span>, that will take any inequality, solve it, and then return the solution.</p>
<p class="indent">First, let&#8217;s learn about the SymPy functions that will help you implement this. The inequality-solving functions are available as three separate functions for polynomial, rational, and all other inequalities. We&#8217;ll need to pick the right function to solve various inequalities, or we&#8217;ll get an error.</p>
<p class="indent">A <em>polynomial</em> is an algebraic expression consisting of a variable and coefficients and involving only the operations of addition, subtraction, and multiplication and only positive powers of the variable. An example of a polynomial inequality is <em>x</em><sup>2</sup> + 4 &lt; 0.</p>
<p class="indent">To solve a polynomial inequality, use the <span class="literal">solve_poly_inequality()</span> function:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Poly,&#160;Symbol,&#160;solve_poly_inequality</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">ineq_obj&#160;=&#160;-x**2&#160;+&#160;4&#160;&lt;&#160;0</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">lhs&#160;=&#160;ineq_obj.lhs</span><br/><span class="ent">&#x278C;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p&#160;=&#160;Poly(lhs,&#160;x)</span><br/><span class="ent">&#x278D;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">rel&#160;=&#160;ineq_obj.rel_op</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">solve_poly_inequality(p,&#160;rel)</span><br/>&#160;&#160;&#160;[(-oo,&#160;-2),&#160;(2,&#160;oo)]</p>
<p class="indent">First, create the expression representing an inequality, &#8211;<em>x</em><sup>2</sup> + 4 &lt; 0, at <span class="ent">&#x278A;</span> and refer to this expression with the label <span class="literal">ineq_obj</span>. Then, extract the left side of the inequality&#8212;that is, the algebraic expression &#8211;<em>x</em><sup>2</sup> + 4&#8212;using the <span class="literal">lhs</span> attribute at <span class="ent">&#x278B;</span>. Next, create a <span class="literal">Poly</span> object at <span class="ent">&#x278C;</span> to represent the polynomial we extracted at <span class="ent">&#x278B;</span>. The second argument passed when creating the object is the symbol object that represents the variable, <span class="literal">x</span>. At <span class="ent">&#x278D;</span>, extract the relational operator from the inequality object using the <span class="literal">rel</span> attribute. Finally, call the <span class="literal">solve_poly_inequality()</span> function with the polynomial object, <span class="literal">p</span>, and <span class="literal">rel</span> as the two arguments. The program returns the solution as a list of tuples, with each tuple representing a solution for the inequality as the lower limit and the upper limit of the range of numbers. For this inequality, the solution is all numbers less than &#8211;2 and all numbers greater than 2.</p>
<p class="indent">A <em>rational expression</em> is an algebraic expression in which the numerator and denominator are both polynomials. Here&#8217;s an example of a rational inequality:</p>
<div class="image2"><img src="graphics/e0117-01.jpg" alt="image"/></div>
<p class="indent"><a id="page_118"/>For rational inequalities, use the <span class="literal">solve_rational_inequalities()</span> function:</p>
<p class="programs">&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol,&#160;Poly,&#160;solve_rational_inequalities</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/><span class="ent">&#x278A;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">ineq_obj&#160;=&#160;((x-1)/(x+2))&#160;&gt;&#160;0</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">lhs&#160;=&#160;ineq_obj.lhs</span><br/><span class="ent">&#x278B;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">numer,&#160;denom&#160;=&#160;lhs.as_numer_denom()</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p1&#160;=&#160;Poly(numer)</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">p2&#160;=&#160;Poly(denom)</span><br/>&#160;&#160;&#160;&gt;&gt;&gt;&#160;<span class="codestrong">rel&#160;=&#160;ineq_obj.rel_op</span><br/><span class="ent">&#x278C;</span>&#160;&gt;&gt;&gt;&#160;<span class="codestrong">solve_rational_inequalities([[((p1,&#160;p2),&#160;rel)]])</span><br/>&#160;&#160;&#160;(-oo,&#160;-2)&#160;U&#160;(1,&#160;oo)</p>
<p class="indent">Create an inequality object representing our example rational inequality at <span class="ent">&#x278A;</span> and then extract the rational expression using the <span class="literal">lhs</span> attribute. Separate out the numerator and the denominator into the labels <span class="literal">numer</span> and <span class="literal">denom</span> using the <span class="literal">as_numer_denom()</span> method at <span class="ent">&#x278B;</span>, which returns a tuple with the numerator and denominator as the two members. Then, create two polynomial objects, <span class="literal">p1</span> and <span class="literal">p2</span>, representing the numerator and denominator, respectively. Retrieve the relational operator and call the <span class="literal">solve_rational_inequalities()</span> function, passing it the two polynomial objects&#8212;<span class="literal">p1</span> and <span class="literal">p2</span>&#8212;and the relational operator.</p>
<p class="indent">The program returns the solution <span class="literal">(-oo, -2) U (1, oo)</span>, where <span class="literal">U</span> denotes that the solution is a <em>union</em> of the two <em>sets</em> of solutions consisting of all numbers less than &#8211;2 and all numbers greater than 1. (We&#8217;ll learn about sets in <a href="ch05.html#ch05">Chapter 5</a>.)</p>
<p class="indent">Finally, sin<em>x</em> &#8211; 0.6 &gt; 0 is an example of an inequality that belongs to neither the polynomial nor rational expression categories. If you have such an inequality to solve, use the <span class="literal">solve_univariate_inequality()</span> function:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;Symbol,&#160;solve,&#160;solve_univariate_inequality,&#160;sin</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">ineq_obj&#160;=&#160;sin(x)&#160;-&#160;0.6&#160;&gt;&#160;0</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">solve_univariate_inequality(ineq_obj,&#160;x,&#160;relational=False)</span><br/>(0.643501108793284,&#160;2.49809154479651)</p>
<p class="indent">Create an inequality object representing the inequality <span class="literal">sin(x) &#8211; 0.6 &gt; 0</span> and then call the <span class="literal">solve_univariate_inequality()</span> function with the first two arguments as the inequality object, <span class="literal">ineq_obj</span>, and the symbol object, <span class="literal">x</span>. The keyword argument <span class="literal">relational=False</span> specifies to the function that we want the solution to be returned as a <em>set</em>. The solution for this inequality turns out to be all numbers lying between the first and second members of the tuple the program returns.</p>
<h5 class="h5" id="ch04lev3sec04"><a id="page_119"/><strong>Hints: Handy Functions</strong></h5>
<p class="noindent">Now remember&#8212;your challenge is (1) to create a function, <span class="literal">isolve()</span>, that will take any inequality and (2) to choose one of the appropriate functions discussed in this section to solve it and return the solution. The following hints may be useful to implement this function.</p>
<p class="indent">The <span class="literal">is_polynomial()</span> method can be used to check whether an expression is a polynomial or not:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">x&#160;=&#160;Symbol('x')</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;x**2&#160;-&#160;4</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr.is_polynomial()</span><br/>True<br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;2*sin(x)&#160;+&#160;3</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr.is_polynomial()</span><br/>False</p>
<p class="indent">The <span class="literal">is_rational_function()</span> can be used to check whether an expression is a rational expression:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;(2+x)/(3+x)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr.is_rational_function()</span><br/>True<br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;2+x</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr.is_rational_function()</span><br/>True<br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr&#160;=&#160;2+sin(x)</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">expr.is_rational_function()</span><br/>False</p>
<p class="indent">The <span class="literal">sympify()</span> function can convert an inequality expressed as a string to an inequality object:</p>
<p class="programs">&gt;&gt;&gt;&#160;<span class="codestrong">from&#160;sympy&#160;import&#160;sympify</span><br/>&gt;&gt;&gt;&#160;<span class="codestrong">sympify('x+3&gt;0')</span><br/>x&#160;+&#160;3&#160;&gt;&#160;0</p>
<p class="indent">When you run your program, it should ask the user to input an inequality expression and print back the solution.<a id="page_120"/></p>
</body>
</html>
